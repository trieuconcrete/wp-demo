jQuery(document).ready(function(t){function a(a){var e=a.calendar.fullCalendar("getDate"),n=e.format("M");t(".calendar_change_month").val(n)}function e(a,e,o,r){var d=t(".st-inbox-form-book"),c=t(".overlay-form",d);c.hide(),xhr=t.ajax({url:st_params.ajax_url,dataType:"json",type:"post",data:{action:"st_get_starttime_activity_frontend",activity_id:a,check_in:e,check_out:o},beforeSend:function(){c.show(),n.addClass("loading")},success:function(a){if(null!=a.data&&a.data.length>0){t(".st_activity_starttime option",d).remove(),t(".activity-starttime",d).show();var e="";for(i=0;i<a.data.length;i++){var o="";"-1"==a.check[i]?a.data[i]==r?e+='<option value="'+a.data[i]+'" selected '+o+">"+a.data[i]+"</option>":e+='<option value="'+a.data[i]+'" '+o+">"+a.data[i]+"</option>":"0"==a.check[i]?a.data[i]==r?e+='<option value="'+a.data[i]+'" selected '+o+">"+a.data[i]+" ( "+st_params.no_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" '+o+">"+a.data[i]+" ( "+st_params.no_vacancy+" )</option>":a.data[i]==r?"1"==a.check[i]?e+='<option value="'+a.data[i]+'" selected '+o+">"+a.data[i]+" ( "+st_params.a_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" selected '+o+">"+a.data[i]+" ( "+a.check[i]+" "+st_params.more_vacancy+" )</option>":"1"==a.check[i]?e+='<option value="'+a.data[i]+'" '+o+">"+a.data[i]+" ( "+st_params.a_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" '+o+">"+a.data[i]+" ( "+a.check[i]+" "+st_params.more_vacancy+" )</option>"}t(".st_activity_starttime",d).append(e),c.hide(),n.removeClass("loading")}else t("#starttime_box").hide(),c.hide(),n.removeClass("loading");requestRunning=!1}}),requestRunning=!0}var n=t(".st-inbox-form-book");if(t(document).ajaxStop(function(){t(".overlay-form").fadeOut(500)}),t("#check_in").length){var o=t("#starttime_hidden_load_form").data("checkin"),r=t("#starttime_hidden_load_form").data("checkout");if(o!=r&&t("input#check_out").parent().parent().show(),""!=o){var d=t("#starttime_hidden_load_form").data("tourid"),c=t("#starttime_hidden_load_form").data("starttime");""!=c&&void 0!==c&&e(d,o,r,c)}}var l=function(a){var n=this;this.container=a,this.calendar=null,this.form_container=null,this.init=function(){n.container=a,n.calendar=t(".calendar-content",n.container),n.form_container=t(".calendar-form",n.container),n.initCalendar()},this.initCalendar=function(){var a=n.calendar.data("hide_adult"),i=n.calendar.data("hide_children"),o=n.calendar.data("hide_infant"),r=n.calendar.data("date-start");n.calendar.fullCalendar({defaultDate:moment(r),firstDay:1,lang:st_params.locale,customButtons:{reloadButton:{text:st_params.text_refresh,click:function(){n.calendar.fullCalendar("refetchEvents")}}},header:{left:"prev",center:"title",right:"next"},contentHeight:900,select:function(t,a,e,i){var o=new Date(t._d).toString("MM"),r=new Date(a._d).toString("MM"),d=(new Date).toString("MM");(o<d||r<d)&&n.calendar.fullCalendar("unselect")},events:function(a,e,i,o){t.ajax({url:st_params.ajax_url,dataType:"json",type:"post",data:{action:"st_get_availability_activity_frontend",activity_id:n.container.data("post-id"),start:a.unix(),end:e.unix(),security:st_params._s},success:function(t){"object"==typeof t?o(t):console.log("Can not get data")},error:function(t){alert("Can not get the availability slot. Lost connect with your sever")}})},eventMouseover:function(t,a,e){},eventMouseout:function(t,a,e){},eventRender:function(r,d,c){console.log(r);var l=r.day,s="none";void 0!==r.date_end&&(l+=" - "+r.date_end,s="group");var u=(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate(),_=n.calendar.fullCalendar("getDate").format("MM"),p=t.fullCalendar.moment(r.start._i).format("MM"),f="";if(p!=_&&(f="next_month"),"available"==r.status){var m="";"on"!=a&&(m+=st_checkout_text.adult_price+": "+r.adult_price+" <br/>"),"on"!=i&&(m+=st_checkout_text.child_price+": "+r.child_price+" <br/>"),"on"!=o&&(m+=st_checkout_text.infant_price+": "+r.infant_price);var v="n";""!=r.starttime&&null!=r.starttime&&(m+='<br /><i class="fa fa-clock-o" aria-hidden="true"></i> '+r.starttime,v="data-starttime='y'"),l="<button "+v+" data-placement='top' title  = '"+m+"' data-toggle='tooltip' class='"+s+" "+f+" btn btn-available'>"+l}else l="<button disabled data-placement='top' title  = 'Disabled' data-toggle='tooltip' class='"+s+" btn btn-disabled'>"+l;u===r.date&&(l+="<span class='triangle'></span>"),l+="</button>",d.addClass("event-"+r.id),d.addClass("event-number-"+r.start.unix()),t(".fc-content",d).html(l),d.bind("click",function(a,i,o){var d="",c="";if(t(this).find("button").hasClass("btn-available")){t(".fc-day-grid-event").removeClass("st-active"),t(this).addClass("st-active");var l=t(this).find("button").data("starttime");date=t.fullCalendar.moment(r.start._i),t("input#check_in").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().parent().show(),d=date.format(st_params.date_format_calendar.toUpperCase()),void 0!==r.end&&r.end&&void 0!==r.end._i?(date=new Date(r.end._i),date.setDate(date.getDate()-1),date=t.fullCalendar.moment(date),c=date.format(st_params.date_format_calendar.toUpperCase()),t("input#check_out").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().parent().show()):(date=t.fullCalendar.moment(r.start._i).format(st_params.date_format_calendar.toUpperCase()),t("input#check_out").val(date).parent().parent().hide()),t("input#adult_price").val(r.adult_price),t("input#child_price").val(r.child_price),t("input#infant_price").val(r.infant_price),t(".page-template-template-user .qtip").length&&t("#select-a-activity").length&&t("#select-a-activity").qtip("hide"),"y"==l?e(n.container.data("post-id"),d,c,""):(t(".st_activity_starttime option").remove(),t(".activity-starttime").hide())}})},eventAfterRender:function(a,e,n){t('[data-toggle="tooltip"]').tooltip({html:!0})},loading:function(a,e){a?t(".calendar-wrapper-inner .overlay-form").fadeIn():t(".calendar-wrapper-inner .overlay-form").fadeOut()}})}};t("#select-a-activity").length&&t("#select-a-activity").length&&t("#select-a-activity").qtip({content:{text:t("#list_activity_item").html()},show:{when:"click",solo:!0},hide:"unfocus",api:{onShow:function(){t(".calendar-wrapper").each(function(e,n){var i=t(this),o=new l(i);o.init(),t("body").on("calendar.change_month",function(t,a){var e=o.calendar.fullCalendar("getDate"),n=e.format("M");e=e.add(a-n,"M"),o.calendar.fullCalendar("gotoDate",e.format("YYYY-MM-DD"))});var r=i.data("current-date");""!=r&&o.calendar.fullCalendar("gotoDate",r),a(o),t(".fc-next-button, .fc-prev-button").click(function(){a(o)})})}}})});