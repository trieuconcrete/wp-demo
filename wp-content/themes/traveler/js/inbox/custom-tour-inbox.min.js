jQuery(document).ready(function(t){function a(a){var e=a.calendar.fullCalendar("getDate"),n=e.format("M");t(".calendar_change_month").val(n)}function e(a,e,d,c){var l=t(".package-info-wrapper"),s=t(".overlay-form",l);s.hide(),n=t.ajax({url:st_params.ajax_url,dataType:"json",type:"post",data:{action:"st_get_starttime_tour_frontend",tour_id:a,check_in:e,check_out:d},beforeSend:function(){s.show(),o.addClass("loading")},success:function(a){if(null!=a.data&&a.data.length>0){t("#starttime_tour option").remove(),t("#starttime_box").show();var e="";for(i=0;i<a.data.length;i++){var n="";"-1"==a.check[i]?a.data[i]==c?e+='<option value="'+a.data[i]+'" selected '+n+">"+a.data[i]+"</option>":e+='<option value="'+a.data[i]+'" '+n+">"+a.data[i]+"</option>":"0"==a.check[i]?a.data[i]==c?e+='<option value="'+a.data[i]+'" selected '+n+">"+a.data[i]+" ( "+st_params.no_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" '+n+">"+a.data[i]+" ( "+st_params.no_vacancy+" )</option>":a.data[i]==c?"1"==a.check[i]?e+='<option value="'+a.data[i]+'" selected '+n+">"+a.data[i]+" ( "+st_params.a_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" selected '+n+">"+a.data[i]+" ( "+a.check[i]+" "+st_params.more_vacancy+" )</option>":"1"==a.check[i]?e+='<option value="'+a.data[i]+'" '+n+">"+a.data[i]+" ( "+st_params.a_vacancy+" )</option>":e+='<option value="'+a.data[i]+'" '+n+">"+a.data[i]+" ( "+a.check[i]+" "+st_params.more_vacancy+" )</option>"}t("#starttime_tour option").remove(),t("#starttime_tour").append(e),s.hide(),o.removeClass("loading")}else t("#starttime_box").hide(),s.hide();r=!1}}),r=!0}var n,o=t(".st-inbox-form-book"),r=!1;if(t('[data-toggle="tooltip"]').tooltip(),t(document).ajaxStop(function(){t(".overlay-form").fadeOut(500)}),t("#check_in").length){var d=t("#check_in").val(),c=t("#check_out").val();d!=c?t("input#check_out").parent().parent().show():t("input#check_out").parent().parent().hide();var l=t('input[name="type_tour"]').val();if("daily_tour"==l){c=t("#check_in").val();t("input#check_out").parent().hide()}if(""!=d){var s=t("#starttime_hidden_load_form").data("tourid"),u=t("#starttime_hidden_load_form").data("starttime");""!=u&&void 0!==u&&(""==c&&(c=d),e(s,d,c,u))}}var p=function(a){var o=this;this.container=a,this.calendar=null,this.form_container=null,this.init=function(){o.container=a,o.calendar=t(".calendar-content",o.container),o.form_container=t(".calendar-form",o.container),o.initCalendar()},this.initCalendar=function(){var a=o.calendar.data("hide_adult"),i=o.calendar.data("hide_children"),d=o.calendar.data("hide_infant"),c=o.calendar.data("price-type"),l=t(".calendar-wrapper").data("current-date");o.calendar.fullCalendar({defaultDate:l,firstDay:1,lang:st_params.locale,customButtons:{reloadButton:{text:st_params.text_refresh,click:function(){o.calendar.fullCalendar("refetchEvents")}}},header:{left:"prev",center:"title",right:"next"},contentHeight:360,select:function(t,a,e,n){var r=new Date(t._d).toString("MM"),i=new Date(a._d).toString("MM"),d=(new Date).toString("MM");(r<d||i<d)&&o.calendar.fullCalendar("unselect")},events:function(a,e,n,r){var i=[];t.ajax({url:st_params.ajax_url,dataType:"json",type:"post",data:{action:"st_get_availability_tour_frontend",tour_id:o.container.data("post-id"),start:a.unix(),end:e.unix(),security:st_params._s},success:function(t){"object"==typeof t?"object"==typeof t.events&&(i=t.events):console.log("Can not get data"),r(i)},error:function(t){alert("Can not get the availability slot. Lost connect with your sever")}})},eventClick:function(t,a,e){o.calendar.trigger("st.select.tour.frontend",[t,a,e])},eventMouseover:function(t,a,e){},eventMouseout:function(t,a,e){},eventRender:function(l,s,u){var p=o.calendar.fullCalendar("getDate").format("MM"),_=t.fullCalendar.moment(l.start._i).format("MM"),f="";_!=p&&(f="next_month");var m=l.day,h="none";void 0!==l.date_end&&(m+=" - "+l.date_end,h="group");var v=(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate();if("available"==l.status){var g="";"person"==c?("on"!=a&&(g+=st_checkout_text.adult_price+": "+l.adult_price+" <br/>"),"on"!=i&&(g+=st_checkout_text.child_price+": "+l.child_price+" <br/>"),"on"!=d&&(g+=st_checkout_text.infant_price+": "+l.infant_price)):g+=st_checkout_text.price+": "+l.base_price;var b="data-starttime='n'";""!=l.starttime&&null!=l.starttime&&(g+='<br /><i class="fa fa-clock-o" aria-hidden="true"></i> '+l.starttime,b="data-starttime='y'"),m="<button "+b+" data-placement='top' title  = '"+g+"' data-toggle='tooltip' class='"+h+" "+f+" btn btn-available'>"+m}else m="<button disabled data-placement='top' title  = 'Disabled' data-toggle='tooltip' class='"+h+" btn btn-disabled'>"+m;v===l.date&&(m+="<span class='triangle'></span>"),m+="</button>",s.addClass("event-"+l.id),s.addClass("event-number-"+l.start.unix()),t(".fc-content",s).html(m),o.calendar.trigger("st_render_calendar_frontend",[l,s,u]),s.bind("click",function(a,i,d){var c="",s="";if(t(this).find("button").hasClass("btn-available")){t(".fc-day-grid-event").removeClass("st-active"),t(this).addClass("st-active"),date=t.fullCalendar.moment(l.start._i),t("input#check_in").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().show(),c=date.format(st_params.date_format_calendar.toUpperCase()),void 0!==l.end&&l.end&&void 0!==l.end._i?(date=new Date(l.end._i),date.setDate(date.getDate()-1),date=t.fullCalendar.moment(date),s=date.format(st_params.date_format_calendar.toUpperCase()),t("input#check_out").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().parent().show()):(date=t.fullCalendar.moment(l.start._i).format(st_params.date_format_calendar.toUpperCase()),t("input#check_out").val(date).parent().parent().hide()),t("input#adult_price").val(l.adult_price),t("input#child_price").val(l.child_price),t("input#infant_price").val(l.infant_price),t(".page-template-template-user .qtip").length&&t("#select-a-tour").length&&t("#select-a-tour").qtip("hide"),r&&n.abort();var u=t(this).find("button").data("starttime");"y"==u?(""==s&&(s=c),e(o.container.data("post-id"),c,s,"")):(t("#starttime_tour option").remove(),t("#starttime_box").hide())}})},eventAfterRender:function(a,e,n){t('[data-toggle="tooltip"]').tooltip({html:!0})},loading:function(a,e){a?t(".calendar-wrapper-inner .overlay-form").fadeIn():t(".calendar-wrapper-inner .overlay-form").fadeOut()}})}};t("#select-a-tour").length&&t("#select-a-tour").qtip({content:{text:t("#list_tour_item").html()},show:{when:"click",solo:!0},hide:"unfocus",api:{onShow:function(){t(".calendar-wrapper").each(function(e,n){var o=t(this),r=new p(o);r.init(),t("body").on("calendar.change_month",function(t,a){var e=r.calendar.fullCalendar("getDate"),n=e.format("M");e=e.add(a-n,"M"),r.calendar.fullCalendar("gotoDate",e.format("YYYY-MM-DD"))});var i=!1;t("body").on("click",".st-tour-tabs-content .request",function(){if(!i){var t=o.data("current-date");""!=t&&setTimeout(function(){r.calendar.fullCalendar("gotoDate",t),i=!0},1e3)}}),a(r),t(".fc-next-button, .fc-prev-button").click(function(){a(r)})})}}})});